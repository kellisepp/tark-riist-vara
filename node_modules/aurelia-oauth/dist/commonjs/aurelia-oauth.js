"use strict";
var aurelia_router_1 = require("aurelia-router");
var oauth_service_1 = require("./oauth-service");
exports.OAuthService = oauth_service_1.OAuthService;
var oauth_token_service_1 = require("./oauth-token-service");
exports.OAuthTokenService = oauth_token_service_1.OAuthTokenService;
var oauth_interceptor_1 = require("./oauth-interceptor");
exports.OAuthInterceptor = oauth_interceptor_1.default;
var oauth_authorize_step_1 = require("./oauth-authorize-step");
function configure(framework, config) {
    var oauthService = framework.container.get(oauth_service_1.OAuthService);
    var oauthTokenService = framework.container.get(oauth_token_service_1.OAuthTokenService);
    var oauthInterceptor = framework.container.get(oauth_interceptor_1.default);
    config(oauthService, oauthTokenService, function (client) {
        client.configure(function (builder) { return builder.withInterceptor(oauthInterceptor); });
    });
    framework.aurelia.start().then(function () {
        oauthService.setTokenOnRedirect();
        var appRouter = framework.container.get(aurelia_router_1.AppRouter);
        appRouter.pipelineProvider.steps.splice(2, 0, oauth_authorize_step_1.OAuthAuthorizeStep);
    });
}
exports.configure = configure;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9hdXJlbGlhLW9hdXRoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxpREFBMkM7QUFFM0MsaURBQStDO0FBMkI3QyxvREFBWTtBQTFCZCw2REFBMEQ7QUEyQnhELG9FQUFpQjtBQTFCbkIseURBQW1EO0FBMkJqRCx1REFBZ0I7QUExQmxCLCtEQUE0RDtBQUU1RCxtQkFDRSxTQUFpQyxFQUNqQyxNQUF5RjtJQUV6RixJQUFNLFlBQVksR0FBaUIsU0FBUyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsNEJBQVksQ0FBQyxDQUFDO0lBQ3pFLElBQU0saUJBQWlCLEdBQXNCLFNBQVMsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLHVDQUFpQixDQUFDLENBQUM7SUFDeEYsSUFBTSxnQkFBZ0IsR0FBcUIsU0FBUyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsMkJBQWdCLENBQUMsQ0FBQztJQUVyRixNQUFNLENBQUMsWUFBWSxFQUFFLGlCQUFpQixFQUFFLFVBQUEsTUFBTTtRQUM1QyxNQUFNLENBQUMsU0FBUyxDQUFDLFVBQUEsT0FBTyxJQUFJLE9BQUEsT0FBTyxDQUFDLGVBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUF6QyxDQUF5QyxDQUFDLENBQUM7SUFDekUsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDLElBQUksQ0FBQztRQUM3QixZQUFZLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztRQUdsQyxJQUFJLFNBQVMsR0FBYyxTQUFTLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQywwQkFBUyxDQUFDLENBQUM7UUFDeEQsU0FBVSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSx5Q0FBa0IsQ0FBQyxDQUFDO0lBQzNFLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQW5CRCw4QkFtQkMiLCJmaWxlIjoiYXVyZWxpYS1vYXV0aC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZyYW1ld29ya0NvbmZpZ3VyYXRpb24gfSBmcm9tICdhdXJlbGlhLWZyYW1ld29yayc7XHJcbmltcG9ydCB7IEFwcFJvdXRlciB9IGZyb20gJ2F1cmVsaWEtcm91dGVyJztcclxuXHJcbmltcG9ydCB7IE9BdXRoU2VydmljZSB9IGZyb20gJy4vb2F1dGgtc2VydmljZSc7XHJcbmltcG9ydCB7IE9BdXRoVG9rZW5TZXJ2aWNlIH0gZnJvbSAnLi9vYXV0aC10b2tlbi1zZXJ2aWNlJztcclxuaW1wb3J0IE9BdXRoSW50ZXJjZXB0b3IgZnJvbSAnLi9vYXV0aC1pbnRlcmNlcHRvcic7XHJcbmltcG9ydCB7IE9BdXRoQXV0aG9yaXplU3RlcCB9IGZyb20gJy4vb2F1dGgtYXV0aG9yaXplLXN0ZXAnO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNvbmZpZ3VyZShcclxuICBmcmFtZXdvcms6IEZyYW1ld29ya0NvbmZpZ3VyYXRpb24sXHJcbiAgY29uZmlnOiAob2F1dGhTZXJ2aWNlLCBvYXV0aFRva2VuU2VydmljZSwgY29uZmlndXJlQ2xpZW50OiAoY2xpZW50OiBhbnkpID0+IHZvaWQpID0+IHZvaWQpIHtcclxuXHJcbiAgY29uc3Qgb2F1dGhTZXJ2aWNlID0gPE9BdXRoU2VydmljZT5mcmFtZXdvcmsuY29udGFpbmVyLmdldChPQXV0aFNlcnZpY2UpO1xyXG4gIGNvbnN0IG9hdXRoVG9rZW5TZXJ2aWNlID0gPE9BdXRoVG9rZW5TZXJ2aWNlPmZyYW1ld29yay5jb250YWluZXIuZ2V0KE9BdXRoVG9rZW5TZXJ2aWNlKTtcclxuICBjb25zdCBvYXV0aEludGVyY2VwdG9yID0gPE9BdXRoSW50ZXJjZXB0b3I+ZnJhbWV3b3JrLmNvbnRhaW5lci5nZXQoT0F1dGhJbnRlcmNlcHRvcik7XHJcblxyXG4gIGNvbmZpZyhvYXV0aFNlcnZpY2UsIG9hdXRoVG9rZW5TZXJ2aWNlLCBjbGllbnQgPT4ge1xyXG4gICAgY2xpZW50LmNvbmZpZ3VyZShidWlsZGVyID0+IGJ1aWxkZXIud2l0aEludGVyY2VwdG9yKG9hdXRoSW50ZXJjZXB0b3IpKTtcclxuICB9KTtcclxuXHJcbiAgZnJhbWV3b3JrLmF1cmVsaWEuc3RhcnQoKS50aGVuKCgpID0+IHtcclxuICAgIG9hdXRoU2VydmljZS5zZXRUb2tlbk9uUmVkaXJlY3QoKTtcclxuXHJcbiAgICAvLyBBZGQgYXV0aG9yaXplIHN0ZXAgYmVmb3JlIHZpZXctbW9kZWwgYWN0aXZhdGUgcHJlZGVmaW5lZCBwaXBlbGluZSBzdGVwXHJcbiAgICBsZXQgYXBwUm91dGVyID0gPEFwcFJvdXRlcj5mcmFtZXdvcmsuY29udGFpbmVyLmdldChBcHBSb3V0ZXIpO1xyXG4gICAgKDxhbnk+YXBwUm91dGVyKS5waXBlbGluZVByb3ZpZGVyLnN0ZXBzLnNwbGljZSgyLCAwLCBPQXV0aEF1dGhvcml6ZVN0ZXApO1xyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQge1xyXG4gIE9BdXRoU2VydmljZSxcclxuICBPQXV0aFRva2VuU2VydmljZSxcclxuICBPQXV0aEludGVyY2VwdG9yXHJcbn0iXX0=
